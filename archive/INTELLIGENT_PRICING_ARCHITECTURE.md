# ğŸ§  Intelligent Pricing & Procurement Architecture

## Sistema Completo con AI e Reverse Engineering

---

## ğŸ“ ARCHITETTURA MODULARE COMPLETA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 0: AI & INTELLIGENCE                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ svc-ai-pricing (6000)                                               â”‚
â”‚ â”œâ”€ Perplexity API Integration                                      â”‚
â”‚ â”‚  â””â”€ Market price research per prodotto                           â”‚
â”‚ â”œâ”€ Reverse Engineering Algorithm                                    â”‚
â”‚ â”‚  â”œâ”€ Analisi quote ricevuti (multi-quantity)                     â”‚
â”‚ â”‚  â”œâ”€ Estrazione curve di costo                                    â”‚
â”‚ â”‚  â”œâ”€ Identificazione: costi fissi, variabili, breakpoint         â”‚
â”‚ â”‚  â””â”€ Proiezioni costo per quantitÃ  non quotate                   â”‚
â”‚ â”œâ”€ Margin Validation Engine                                        â”‚
â”‚ â”‚  â”œâ”€ Regole configurabili margine minimo                         â”‚
â”‚ â”‚  â”œâ”€ Alert se prezzo troppo basso                                â”‚
â”‚ â”‚  â””â”€ Suggerimenti automatici prezzo ottimale                     â”‚
â”‚ â””â”€ Cost Structure Analysis                                          â”‚
â”‚    â”œâ”€ Pattern recognition fornitori                                â”‚
â”‚    â”œâ”€ Benchmark vs mercato                                         â”‚
â”‚    â””â”€ Storico per ML predictions                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 1: CRM & CONTACTS                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ svc-crm-unified (6100)                                              â”‚
â”‚ â”œâ”€ Clienti, Fornitori, Lead, Partner, Dipendenti                  â”‚
â”‚ â”œâ”€ Rubrica contatti unificata                                      â”‚
â”‚ â”œâ”€ Indirizzi multipli (billing, shipping, warehouse)              â”‚
â”‚ â”œâ”€ Persone di riferimento                                          â”‚
â”‚ â”œâ”€ AttivitÃ  e storico interazioni                                  â”‚
â”‚ â””â”€ Rating e valutazioni (quality, reliability)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 2: PROCUREMENT (ACQUISTI)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ svc-procurement (5600) - ENHANCED                                   â”‚
â”‚ â”œâ”€ RFQ Request con AI Policy                                       â”‚
â”‚ â”‚  â”œâ”€ Multi-Quantity Request automatica                           â”‚
â”‚ â”‚  â”‚  â””â”€ Policy: [100, 500, 1000, 5000, 10000] pz               â”‚
â”‚ â”‚  â”œâ”€ Template configurabili per tipo prodotto                    â”‚
â”‚ â”‚  â””â”€ Deadline tracking                                            â”‚
â”‚ â”œâ”€ Quote Received & Analysis                                        â”‚
â”‚ â”‚  â”œâ”€ Import automatico quote                                      â”‚
â”‚ â”‚  â”œâ”€ Parsing multi-quantity                                       â”‚
â”‚ â”‚  â”œâ”€ â†’ svc-ai-pricing per reverse engineering                    â”‚
â”‚ â”‚  â””â”€ Visualizzazione curve costo                                  â”‚
â”‚ â”œâ”€ Supplier Comparison Matrix                                       â”‚
â”‚ â”‚  â”œâ”€ Confronto prezzi per quantitÃ                                â”‚
â”‚ â”‚  â”œâ”€ Best price highlighting                                      â”‚
â”‚ â”‚  â”œâ”€ Total cost (price + shipping + lead time)                   â”‚
â”‚ â”‚  â””â”€ Quality score weighting                                      â”‚
â”‚ â””â”€ Award & PO Creation                                              â”‚
â”‚    â””â”€ â†’ svc-orders-purchase                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 3: ORDERS                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ svc-orders-purchase (6200) - Ordini Fornitori                      â”‚
â”‚ â”œâ”€ Purchase Orders (PO)                                             â”‚
â”‚ â”‚  â”œâ”€ Da RFQ awarded                                               â”‚
â”‚ â”‚  â”œâ”€ Da MRP (fabbisogni)                                          â”‚
â”‚ â”‚  â””â”€ Da reorder point                                             â”‚
â”‚ â”œâ”€ PO Tracking                                                      â”‚
â”‚ â”‚  â”œâ”€ Status: draft, sent, confirmed, partial, completed          â”‚
â”‚ â”‚  â”œâ”€ Expected delivery date                                       â”‚
â”‚ â”‚  â””â”€ Collegamenti: shipments, invoices                            â”‚
â”‚ â”œâ”€ Goods Receipt                                                    â”‚
â”‚ â”‚  â”œâ”€ Quality control                                              â”‚
â”‚ â”‚  â””â”€ â†’ svc-inventory (carico)                                    â”‚
â”‚ â””â”€ Supplier Performance                                             â”‚
â”‚    â”œâ”€ On-time delivery rate                                        â”‚
â”‚    â”œâ”€ Quality issues tracking                                      â”‚
â”‚    â””â”€ â†’ aggiorna crm.contacts.reliability_score                    â”‚
â”‚                                                                      â”‚
â”‚ svc-orders-sales (6300) - Ordini Clienti                           â”‚
â”‚ â”œâ”€ Sales Orders (SO)                                                â”‚
â”‚ â”‚  â”œâ”€ Da quote accepted                                            â”‚
â”‚ â”‚  â”œâ”€ Da ecommerce/API                                             â”‚
â”‚ â”‚  â””â”€ Manual entry                                                 â”‚
â”‚ â”œâ”€ Order Fulfillment                                                â”‚
â”‚ â”‚  â”œâ”€ Check inventory availability                                 â”‚
â”‚ â”‚  â”œâ”€ â†’ svc-mrp se make-to-order                                  â”‚
â”‚ â”‚  â”œâ”€ â†’ svc-inventory (riserva stock)                             â”‚
â”‚ â”‚  â””â”€ Shipping management                                          â”‚
â”‚ â”œâ”€ Invoicing                                                        â”‚
â”‚ â”‚  â””â”€ â†’ svc-billing                                                â”‚
â”‚ â””â”€ Customer Stats                                                   â”‚
â”‚    â”œâ”€ Order frequency                                              â”‚
â”‚    â”œâ”€ Average order value                                          â”‚
â”‚    â””â”€ â†’ aggiorna CRM customer scoring                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 4: INVENTORY                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ svc-inventory (6400)                                                â”‚
â”‚ â”œâ”€ Items/SKU Master                                                 â”‚
â”‚ â”‚  â”œâ”€ Codice articolo, descrizione                                â”‚
â”‚ â”‚  â”œâ”€ Categoria, tipo                                              â”‚
â”‚ â”‚  â”œâ”€ UoM (unit of measure)                                        â”‚
â”‚ â”‚  â”œâ”€ Peso, dimensioni                                             â”‚
â”‚ â”‚  â””â”€ â†’ link svc-pricelists per prezzi                            â”‚
â”‚ â”œâ”€ Stock Management                                                 â”‚
â”‚ â”‚  â”œâ”€ Giacenza per ubicazione                                     â”‚
â”‚ â”‚  â”œâ”€ Stock disponibile, riservato, in transito                   â”‚
â”‚ â”‚  â”œâ”€ Min/max stock levels                                         â”‚
â”‚ â”‚  â””â”€ Reorder point â†’ trigger PO                                   â”‚
â”‚ â”œâ”€ Movements                                                        â”‚
â”‚ â”‚  â”œâ”€ IN: PO receipt, production output, returns                  â”‚
â”‚ â”‚  â”œâ”€ OUT: SO shipment, production consumption, scrap             â”‚
â”‚ â”‚  â””â”€ Transfer between locations                                   â”‚
â”‚ â”œâ”€ Lots & Serial Numbers                                            â”‚
â”‚ â”‚  â”œâ”€ TracciabilitÃ  lotto                                         â”‚
â”‚ â”‚  â”œâ”€ Scadenze                                                     â”‚
â”‚ â”‚  â””â”€ FIFO/FEFO logic                                              â”‚
â”‚ â”œâ”€ Physical Inventory                                               â”‚
â”‚ â”‚  â”œâ”€ Conteggi periodici                                          â”‚
â”‚ â”‚  â”œâ”€ Cycle counting                                               â”‚
â”‚ â”‚  â””â”€ Adjustments                                                  â”‚
â”‚ â””â”€ Locations                                                        â”‚
â”‚    â”œâ”€ Warehouse structure                                          â”‚
â”‚    â”œâ”€ Aisles, racks, bins                                          â”‚
â”‚    â””â”€ Barcode/QR management                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 5: PRICELISTS                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ svc-pricelists-purchase (6500) - Listini Acquisto                  â”‚
â”‚ â”œâ”€ Supplier Pricelists                                              â”‚
â”‚ â”‚  â”œâ”€ Un fornitore â†’ N listini                                    â”‚
â”‚ â”‚  â”œâ”€ ValiditÃ  temporale (from/to date)                           â”‚
â”‚ â”‚  â”œâ”€ Currency                                                     â”‚
â”‚ â”‚  â””â”€ Status: draft, active, expired                              â”‚
â”‚ â”œâ”€ Price Breaks (quantity-based)                                    â”‚
â”‚ â”‚  â”œâ”€ 1-99 pz: â‚¬10                                                â”‚
â”‚ â”‚  â”œâ”€ 100-499 pz: â‚¬8.50                                           â”‚
â”‚ â”‚  â”œâ”€ 500+ pz: â‚¬7.00                                              â”‚
â”‚ â”‚  â””â”€ Interpolazione per quantitÃ  intermedie                      â”‚
â”‚ â”œâ”€ Cost Analysis                                                    â”‚
â”‚ â”‚  â”œâ”€ Storico prezzi per trending                                 â”‚
â”‚ â”‚  â”œâ”€ â†’ svc-ai-pricing per anomaly detection                      â”‚
â”‚ â”‚  â””â”€ Alert aumenti improvvisi                                     â”‚
â”‚ â””â”€ Best Price Engine                                                â”‚
â”‚    â”œâ”€ Real-time comparison tra fornitori                          â”‚
â”‚    â”œâ”€ Considera: prezzo + lead time + quality                     â”‚
â”‚    â””â”€ Suggerimenti acquisto ottimale                               â”‚
â”‚                                                                      â”‚
â”‚ svc-pricelists-sales (6600) - Listini Vendita                      â”‚
â”‚ â”œâ”€ Customer Pricelists                                              â”‚
â”‚ â”‚  â”œâ”€ Listino base (standard)                                     â”‚
â”‚ â”‚  â”œâ”€ Listino per categoria cliente (Gold, Silver, Bronze)       â”‚
â”‚ â”‚  â”œâ”€ Listino personalizzato per cliente specifico               â”‚
â”‚ â”‚  â””â”€ Listino per canale (retail, wholesale, ecommerce)          â”‚
â”‚ â”œâ”€ Pricing Rules Engine                                             â”‚
â”‚ â”‚  â”œâ”€ Base: costo interno + markup %                              â”‚
â”‚ â”‚  â”œâ”€ Formula: (internal_cost * (1 + markup/100))                â”‚
â”‚ â”‚  â”œâ”€ â†’ svc-quotations per workflow pricing                       â”‚
â”‚ â”‚  â””â”€ â†’ svc-ai-pricing per market validation                      â”‚
â”‚ â”œâ”€ Margin Protection                                                â”‚
â”‚ â”‚  â”œâ”€ Margine minimo per categoria prodotto                       â”‚
â”‚ â”‚  â”œâ”€ Alert se prezzo < soglia                                    â”‚
â”‚ â”‚  â”œâ”€ Richiede approvazione manager                               â”‚
â”‚ â”‚  â””â”€ â†’ svc-ai-pricing per suggest optimal price                  â”‚
â”‚ â”œâ”€ Promotions & Discounts                                           â”‚
â”‚ â”‚  â”œâ”€ Sconti temporanei                                           â”‚
â”‚ â”‚  â”œâ”€ Volume discounts                                             â”‚
â”‚ â”‚  â”œâ”€ Bundle pricing                                               â”‚
â”‚ â”‚  â””â”€ Coupon codes                                                 â”‚
â”‚ â””â”€ Competitive Intelligence                                         â”‚
â”‚    â”œâ”€ â†’ svc-ai-pricing + Perplexity                               â”‚
â”‚    â”œâ”€ Market price research                                        â”‚
â”‚    â”œâ”€ Competitor pricing tracking                                  â”‚
â”‚    â””â”€ Price positioning recommendations                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 6: QUOTATIONS (giÃ  esistente ma enhanced)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ svc-quotations (5800) - Preventivi OUT                              â”‚
â”‚ â”œâ”€ Internal Cost Calculation                                        â”‚
â”‚ â”‚  â”œâ”€ Workflow editor con nodi                                    â”‚
â”‚ â”‚  â”œâ”€ Calcolo costo interno dettagliato                           â”‚
â”‚ â”‚  â”œâ”€ Machine time, operator, materials                           â”‚
â”‚ â”‚  â””â”€ â†’ costo_interno                                             â”‚
â”‚ â”œâ”€ Margin Application                                               â”‚
â”‚ â”‚  â”œâ”€ Applica markup configurabile                                â”‚
â”‚ â”‚  â”œâ”€ costo_interno * (1 + margin%)                               â”‚
â”‚ â”‚  â”œâ”€ â†’ prezzo_listino_proposto                                   â”‚
â”‚ â”‚  â””â”€ Check vs svc-pricelists-sales margine minimo                â”‚
â”‚ â”œâ”€ AI Market Validation                                             â”‚
â”‚ â”‚  â”œâ”€ â†’ svc-ai-pricing                                            â”‚
â”‚ â”‚  â”œâ”€ Perplexity API: ricerca prezzi mercato                      â”‚
â”‚ â”‚  â”œâ”€ Competitor analysis                                          â”‚
â”‚ â”‚  â””â”€ Suggerimenti: "prezzo troppo alto/basso"                   â”‚
â”‚ â”œâ”€ Price Finalization                                               â”‚
â”‚ â”‚  â”œâ”€ Modifica manuale prezzo finale                              â”‚
â”‚ â”‚  â”œâ”€ Salva in svc-pricelists-sales se approvato                 â”‚
â”‚ â”‚  â””â”€ Invia quote al cliente                                      â”‚
â”‚ â””â”€ Quote to Order                                                   â”‚
â”‚    â”œâ”€ Se accettato â†’ svc-orders-sales                              â”‚
â”‚    â””â”€ â†’ svc-mrp se produzione                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 7: MRP & PRODUCTION                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ svc-mrp (6700)                                                       â”‚
â”‚ â”œâ”€ Bill of Materials (BOM)                                          â”‚
â”‚ â”‚  â”œâ”€ Distinta base prodotto                                      â”‚
â”‚ â”‚  â”œâ”€ Component list con quantitÃ                                  â”‚
â”‚ â”‚  â””â”€ Alternative components                                       â”‚
â”‚ â”œâ”€ MRP Calculation                                                  â”‚
â”‚ â”‚  â”œâ”€ Input: sales orders, forecast                               â”‚
â”‚ â”‚  â”œâ”€ Esplosione BOM                                               â”‚
â”‚ â”‚  â”œâ”€ Check inventory availability                                 â”‚
â”‚ â”‚  â”œâ”€ Calcolo fabbisogni netti                                    â”‚
â”‚ â”‚  â””â”€ â†’ genera planned orders                                      â”‚
â”‚ â”œâ”€ Production Orders                                                â”‚
â”‚ â”‚  â”œâ”€ Schedulazione su macchine                                   â”‚
â”‚ â”‚  â”œâ”€ CapacitÃ  produttiva                                         â”‚
â”‚ â”‚  â”œâ”€ Material reservation                                         â”‚
â”‚ â”‚  â””â”€ Work orders to shop floor                                    â”‚
â”‚ â”œâ”€ Material Consumption                                             â”‚
â”‚ â”‚  â”œâ”€ Backflush o manual issue                                    â”‚
â”‚ â”‚  â””â”€ â†’ svc-inventory (scarico)                                   â”‚
â”‚ â”œâ”€ Production Output                                                â”‚
â”‚ â”‚  â”œâ”€ Finished goods                                               â”‚
â”‚ â”‚  â””â”€ â†’ svc-inventory (carico)                                    â”‚
â”‚ â””â”€ Procurement Trigger                                              â”‚
â”‚    â”œâ”€ Se manca materiale                                           â”‚
â”‚    â””â”€ â†’ svc-procurement (auto RFQ)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ FLUSSO COMPLETO: DA PREVENTIVO A LISTINO

### Scenario: Cliente chiede preventivo per 1000 libretti A5

```
1. CALCOLO COSTO INTERNO
   â”œâ”€ svc-quotations/workflow-editor
   â”‚  â”œâ”€ Nodo: Macchina (Heidelberg) â†’ 2h Ã— â‚¬150/h = â‚¬300
   â”‚  â”œâ”€ Nodo: Operatore â†’ 2h Ã— â‚¬28/h = â‚¬56
   â”‚  â”œâ”€ Nodo: Carta (500kg Ã— â‚¬2.50/kg Ã— 1.05 waste) = â‚¬1,312
   â”‚  â”œâ”€ Nodo: Inchiostro â†’ â‚¬200
   â”‚  â”œâ”€ Nodo: Legatrice â†’ 1h Ã— â‚¬85/h = â‚¬85
   â”‚  â”œâ”€ Nodo: Costi fissi (setup) = â‚¬150
   â”‚  â””â”€ TOTALE COSTO INTERNO = â‚¬2,103

2. APPLICAZIONE MARGINE
   â”œâ”€ Margine target: 35%
   â”œâ”€ Calcolo: â‚¬2,103 Ã— 1.35 = â‚¬2,839
   â””â”€ PREZZO LISTINO PROPOSTO = â‚¬2,839

3. VALIDAZIONE AI (svc-ai-pricing + Perplexity)
   â”œâ”€ Query: "Prezzo mercato stampa 1000 libretti A5 Italia"
   â”œâ”€ Risultati:
   â”‚  â”œâ”€ Range mercato: â‚¬2,500 - â‚¬3,200
   â”‚  â”œâ”€ Media: â‚¬2,850
   â”‚  â””â”€ âœ… Il tuo prezzo â‚¬2,839 Ã¨ competitivo
   â””â”€ Suggerimento: "Prezzo in linea con mercato"

4. CONTROLLO MARGINE MINIMO
   â”œâ”€ svc-pricelists-sales: margine minimo = 25%
   â”œâ”€ Il tuo margine: 35% âœ…
   â””â”€ OK, nessun alert

5. APPROVAZIONE & SALVATAGGIO
   â”œâ”€ Manager approva prezzo finale: â‚¬2,850
   â”œâ”€ Salva in svc-pricelists-sales
   â”‚  â””â”€ Item: "Libretto A5 100 pagine"
   â”‚      â”œâ”€ Qty 500-999: â‚¬3.20/pz
   â”‚      â”œâ”€ Qty 1000-2999: â‚¬2.85/pz â† salvato
   â”‚      â””â”€ Qty 3000+: â‚¬2.50/pz
   â””â”€ Invia quote al cliente

6. CLIENTE ACCETTA
   â”œâ”€ Quote status: accepted
   â”œâ”€ â†’ svc-orders-sales (crea SO)
   â””â”€ â†’ svc-mrp (pianifica produzione)
```

---

## ğŸ§® REVERSE ENGINEERING RFQ (Preventivi IN)

### Scenario: Chiediamo quote a 3 fornitori carta

```
1. RFQ MULTI-QUANTITY (Policy Auto)
   â”œâ”€ svc-procurement: crea RFQ
   â”œâ”€ Item: "Carta patinata 115g"
   â”œâ”€ QuantitÃ  richieste (auto-policy):
   â”‚  â”œâ”€ 100 kg
   â”‚  â”œâ”€ 500 kg
   â”‚  â”œâ”€ 1,000 kg
   â”‚  â”œâ”€ 5,000 kg
   â”‚  â””â”€ 10,000 kg
   â””â”€ Invia a 3 fornitori

2. RICEZIONE QUOTE
   Fornitore A:
   â”œâ”€ 100kg: â‚¬350 (â‚¬3.50/kg)
   â”œâ”€ 500kg: â‚¬1,375 (â‚¬2.75/kg)
   â”œâ”€ 1,000kg: â‚¬2,500 (â‚¬2.50/kg)
   â”œâ”€ 5,000kg: â‚¬11,000 (â‚¬2.20/kg)
   â””â”€ 10,000kg: â‚¬20,000 (â‚¬2.00/kg)

   Fornitore B:
   â”œâ”€ 100kg: â‚¬380 (â‚¬3.80/kg)
   â”œâ”€ 500kg: â‚¬1,450 (â‚¬2.90/kg)
   â”œâ”€ 1,000kg: â‚¬2,600 (â‚¬2.60/kg)
   â””â”€ ... (missing data)

   Fornitore C:
   â””â”€ Flat rate: â‚¬2.80/kg (qualsiasi quantitÃ )

3. AI REVERSE ENGINEERING (svc-ai-pricing)
   â”œâ”€ Analisi Fornitore A:
   â”‚  â”œâ”€ Costi fissi stimati: â‚¬150
   â”‚  â”œâ”€ Costo variabile base: â‚¬1.90/kg
   â”‚  â”œâ”€ Curve: y = 150 + (1.90 + 0.60/âˆšqty) Ã— qty
   â”‚  â””â”€ Proiezione per 2,000kg: â‚¬4,780 (~â‚¬2.39/kg)
   â”‚
   â”œâ”€ Analisi Fornitore B:
   â”‚  â”œâ”€ Dati incompleti
   â”‚  â”œâ”€ Interpola: 5,000kg stimato ~â‚¬11,500
   â”‚  â””â”€ Meno affidabile per grosse quantitÃ 
   â”‚
   â””â”€ Analisi Fornitore C:
   â”‚  â”œâ”€ Nessuna economia di scala
   â”‚  â”œâ”€ Conveniente solo per piccoli ordini
   â”‚  â””â”€ Break-even vs A: 180kg

4. DECISION SUPPORT
   â”œâ”€ Visualizzazione grafici curve costo
   â”œâ”€ Tabella comparison:
   â”‚   Qty    | Forn.A  | Forn.B  | Forn.C  | Best
   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚   100    | â‚¬350    | â‚¬380    | â‚¬280    | C âœ“
   â”‚   500    | â‚¬1,375  | â‚¬1,450  | â‚¬1,400  | A âœ“
   â”‚   2,000  | â‚¬4,780* | â‚¬5,100* | â‚¬5,600  | A âœ“
   â”‚   10,000 | â‚¬20,000 | â‚¬23,000*| â‚¬28,000 | A âœ“
   â”‚
   â””â”€ * = proiezione AI

5. STRATEGIC INSIGHTS
   â”œâ”€ Suggerimento: "Fornitore A migliore per ordini >500kg"
   â”œâ”€ Alert: "Fornitore B dati incompleti, richiedi quote complete"
   â”œâ”€ Tip: "Negozia flat rate con A per 10,000+ kg"
   â””â”€ Salva analisi per future RFQ
```

---

## ğŸ¤– AI-POWERED FEATURES

### 1. **Perplexity Integration** (Market Research)
```typescript
// svc-ai-pricing/perplexity.ts
async function getMarketPrice(product: string, quantity: number) {
  const query = `
    Qual Ã¨ il prezzo medio di mercato in Italia per:
    - Prodotto: ${product}
    - QuantitÃ : ${quantity}
    - Includi: range prezzi, fornitori tipici, fattori che influenzano il prezzo
  `;

  const response = await perplexity.ask(query);

  return {
    priceRange: { min: 2500, max: 3200 },
    average: 2850,
    sources: [...],
    insights: [...]
  };
}
```

### 2. **RFQ Reverse Engineering Algorithm**
```typescript
// svc-ai-pricing/reverse-engineer.ts
function analyzeSupplierCostStructure(quotes: Quote[]) {
  // Ordina per quantitÃ 
  const sorted = quotes.sort((a, b) => a.quantity - b.quantity);

  // Calcola cost per unit
  const pricePerUnit = quotes.map(q => ({
    qty: q.quantity,
    unitPrice: q.total_price / q.quantity
  }));

  // Identifica breakpoints
  const breakpoints = findBreakpoints(pricePerUnit);

  // Estrai costi fissi e variabili
  const fixedCost = estimateFixedCost(pricePerUnit);
  const variableCost = estimateVariableCost(pricePerUnit, fixedCost);

  // Crea modello predittivo
  const model = fitCurve(pricePerUnit, fixedCost, variableCost);

  // Proietta prezzi per quantitÃ  non quotate
  const projections = projectPrices(model, [200, 750, 2000, 7500]);

  return {
    fixedCost,
    variableCost,
    breakpoints,
    model,
    projections,
    confidence: calculateConfidence(quotes)
  };
}
```

### 3. **Margin Protection Rules**
```typescript
// svc-pricelists-sales/margin-rules.ts
interface MarginRule {
  productCategory: string;
  minMarginPercent: number;
  targetMarginPercent: number;
  approvalRequired: boolean;
  alertThreshold: number;
}

const rules: MarginRule[] = [
  {
    productCategory: 'stampa_offset',
    minMarginPercent: 25,
    targetMarginPercent: 35,
    approvalRequired: true, // se < 25%
    alertThreshold: 30 // avvisa se < 30%
  },
  {
    productCategory: 'legatoria',
    minMarginPercent: 30,
    targetMarginPercent: 40,
    approvalRequired: true,
    alertThreshold: 35
  }
];

function validatePrice(internalCost: number, proposedPrice: number, category: string) {
  const rule = rules.find(r => r.productCategory === category);
  const actualMargin = ((proposedPrice - internalCost) / internalCost) * 100;

  if (actualMargin < rule.minMarginPercent) {
    return {
      status: 'blocked',
      message: `Margine ${actualMargin}% < minimo ${rule.minMarginPercent}%`,
      requiresApproval: true
    };
  }

  if (actualMargin < rule.alertThreshold) {
    return {
      status: 'warning',
      message: `Margine basso: ${actualMargin}%`,
      suggestedPrice: internalCost * (1 + rule.targetMarginPercent / 100)
    };
  }

  return { status: 'ok', margin: actualMargin };
}
```

---

## ğŸ¯ PROSSIMI PASSI

Vuoi che proceda a creare:

1. **svc-inventory** (magazzino completo)
2. **svc-orders-purchase** (ordini fornitori)
3. **svc-orders-sales** (ordini clienti)
4. **svc-pricelists-purchase** (listini acquisto con AI)
5. **svc-pricelists-sales** (listini vendita con margin rules)
6. **svc-ai-pricing** (core AI engine + Perplexity)
7. **Frontend unificato per gestione**

Oppure preferisci che dettagli meglio qualche parte specifica?

La cosa piÃ¹ potente Ã¨ che ogni modulo comunica con gli altri ma Ã¨ indipendente!
