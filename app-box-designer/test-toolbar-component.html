<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Box Designer CAD - Professional Toolbar (Week 3 Day 11)</title>
  <link rel="stylesheet" href="styles/main.css">
  <style>
    /* Additional layout styles for demo */
    .app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .canvas-wrapper {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    #canvas {
      display: block;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Toolbar Container (will be populated by Toolbar component) -->
    <div id="toolbar-container"></div>

    <!-- Canvas Container -->
    <div class="canvas-wrapper">
      <canvas id="canvas"></canvas>

      <!-- Stats Overlay -->
      <div class="stats-overlay">
        <div class="stat-line">
          <span class="stat-label">Lines:</span>
          <span class="stat-value" id="stat-lines">0</span>
        </div>
        <div class="stat-line">
          <span class="stat-label">Rectangles:</span>
          <span class="stat-value" id="stat-rects">0</span>
        </div>
        <div class="stat-line">
          <span class="stat-label">Circles:</span>
          <span class="stat-value" id="stat-circles">0</span>
        </div>
        <div class="stat-line">
          <span class="stat-label">Arcs:</span>
          <span class="stat-value" id="stat-arcs">0</span>
        </div>
        <div class="stat-line">
          <span class="stat-label">Total:</span>
          <span class="stat-value" id="stat-total">0</span>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-line">
          <span class="stat-label">Selected:</span>
          <span class="stat-value" id="stat-selected">0</span>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-line">
          <span class="stat-label">Tool:</span>
          <span class="stat-value" id="stat-tool">select</span>
        </div>
        <div class="stat-line">
          <span class="stat-label">FPS:</span>
          <span class="stat-value" id="stat-fps">0</span>
        </div>
        <div class="stat-line">
          <span class="stat-label">Zoom:</span>
          <span class="stat-value" id="stat-zoom">100%</span>
        </div>
      </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-message" id="status-message">
        Ready - Week 3 Day 11: Professional Toolbar Component
      </div>
      <div class="status-info">
        <div class="status-info-item">
          <span class="status-info-label">Cursor:</span>
          <span class="status-info-value" id="cursor-pos">0, 0</span>
        </div>
        <div class="status-info-item">
          <span class="status-info-label">Objects:</span>
          <span class="status-info-value" id="object-count">0</span>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { CADEngine } from './cad-tools/CADEngine.js';
    import { Toolbar } from './src/components/Toolbar.js';

    // Initialize canvas
    const canvas = document.getElementById('canvas');
    const updateCanvasSize = () => {
      const wrapper = canvas.parentElement;
      canvas.width = wrapper.clientWidth;
      canvas.height = wrapper.clientHeight;
      if (window.app && window.app.engine) {
        window.app.engine.render();
      }
    };
    updateCanvasSize();

    // CAD Application wrapper
    class CADApp {
      constructor() {
        this.engine = new CADEngine(canvas);
        this.toolbar = null;

        // Enable profiling
        this.engine.toggleProfiling(true);

        // Initialize toolbar
        this.initToolbar();

        // Set initial tool
        this.engine.setTool('select');

        // Setup status update polling
        this.setupStatusUpdates();

        console.log('üé® CAD Application initialized');
        console.log('üìê Week 3 Day 11: Professional Toolbar Component');
        console.log('‚ú® All 8 tools available with clean UI');
      }

      initToolbar() {
        const toolbarContainer = document.getElementById('toolbar-container');
        this.toolbar = new Toolbar(this, toolbarContainer);

        console.log('üîß Toolbar component created');
      }

      setupStatusUpdates() {
        // Update stats every 100ms
        setInterval(() => {
          this.updateStats();
          this.updateStatus();
        }, 100);

        // Track cursor position
        canvas.addEventListener('mousemove', (e) => {
          const rect = canvas.getBoundingClientRect();
          const screenX = e.clientX - rect.left;
          const screenY = e.clientY - rect.top;

          // Convert to world coordinates
          const worldPoint = this.engine.screenToWorld({ x: screenX, y: screenY });

          document.getElementById('cursor-pos').textContent =
            `${Math.round(worldPoint.x)}, ${Math.round(worldPoint.y)}`;
        });
      }

      updateStats() {
        const lineCount = this.engine.objects.filter(obj => obj.type === 'line').length;
        const rectCount = this.engine.objects.filter(obj => obj.type === 'rectangle').length;
        const circleCount = this.engine.objects.filter(obj => obj.type === 'circle').length;
        const arcCount = this.engine.objects.filter(obj => obj.type === 'arc').length;

        document.getElementById('stat-lines').textContent = lineCount;
        document.getElementById('stat-rects').textContent = rectCount;
        document.getElementById('stat-circles').textContent = circleCount;
        document.getElementById('stat-arcs').textContent = arcCount;
        document.getElementById('stat-total').textContent = this.engine.objects.length;
        document.getElementById('object-count').textContent = this.engine.objects.length;

        document.getElementById('stat-fps').textContent = this.engine.profiling.fps.toFixed(1);
        document.getElementById('stat-zoom').textContent = (this.engine.zoom * 100).toFixed(0) + '%';

        // Update selected count
        const selectTool = this.engine.tools.select;
        const selectedCount = selectTool ? selectTool.selectedObjects.length : 0;
        document.getElementById('stat-selected').textContent = selectedCount;

        // Update current tool name
        document.getElementById('stat-tool').textContent = this.engine.currentToolName || 'none';

        // Update undo/redo button states
        if (this.toolbar) {
          this.toolbar.setUndoEnabled(this.engine.canUndo());
          this.toolbar.setRedoEnabled(this.engine.canRedo());
        }
      }

      updateStatus() {
        const statusMsg = this.engine.statusMessage || 'Ready';
        document.getElementById('status-message').textContent = statusMsg;

        if (this.toolbar) {
          this.toolbar.updateStatus(statusMsg);
        }
      }
    }

    // Create app instance
    window.app = new CADApp();

    // Resize handler
    window.addEventListener('resize', updateCanvasSize);

    // Global keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      // Don't interfere with browser shortcuts
      if (e.ctrlKey || e.metaKey) {
        // Undo/Redo
        if (e.key === 'z') {
          if (e.shiftKey) {
            window.app.engine.redo();
          } else {
            window.app.engine.undo();
          }
          e.preventDefault();
          return;
        }
        return;
      }

      const currentTool = window.app.engine.currentTool;

      switch(e.key.toLowerCase()) {
        case 's':
          if (!currentTool || !currentTool.isMoving) {
            window.app.toolbar.setActiveTool('select');
          }
          break;
        case 'm':
          window.app.toolbar.setActiveTool('move');
          break;
        case 'l':
          window.app.toolbar.setActiveTool('line');
          break;
        case 'r':
          if (!e.shiftKey) {
            window.app.toolbar.setActiveTool('rectangle');
          }
          break;
        case 'c':
          if (!currentTool || window.app.engine.currentToolName !== 'line') {
            window.app.toolbar.setActiveTool('circle');
          }
          break;
        case 'a':
          if (!e.ctrlKey) {
            window.app.toolbar.setActiveTool('arc');
          }
          break;
        case 't':
          window.app.toolbar.setActiveTool('trim');
          break;
        case 'o':
          window.app.toolbar.setActiveTool('offset');
          break;
      }
    });

    console.log('‚å®Ô∏è  Keyboard Shortcuts:');
    console.log('   S - Select   M - Move    L - Line    R - Rectangle');
    console.log('   C - Circle   A - Arc     T - Trim    O - Offset');
    console.log('   Ctrl+Z - Undo   Ctrl+Shift+Z - Redo');
    console.log('');
    console.log('üéØ Try the new toolbar!');
    console.log('   - Click tool buttons to switch tools');
    console.log('   - Change line types (Cut, Crease, Perf, Bleed)');
    console.log('   - Use Undo/Redo buttons');
    console.log('   - Toggle Grid');
  </script>
</body>
</html>
