<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fillet Tool Demo - Box Designer CAD</title>
  <link rel="stylesheet" href="styles/main.css">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    .demo-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .demo-header {
      background: var(--bg-secondary);
      padding: 16px 24px;
      border-bottom: 1px solid var(--border-primary);
    }

    .demo-title {
      margin: 0 0 8px 0;
      font-size: 24px;
      color: var(--text-accent);
    }

    .demo-subtitle {
      margin: 0;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .demo-controls {
      background: var(--bg-secondary);
      padding: 12px 24px;
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .control-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .control-label {
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .demo-main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .canvas-area {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    #canvas {
      display: block;
      width: 100%;
      height: 100%;
      cursor: crosshair;
    }

    .demo-sidebar {
      width: 320px;
      background: var(--bg-secondary);
      border-left: 1px solid var(--border-primary);
      overflow-y: auto;
      padding: 16px;
    }

    .info-section {
      margin-bottom: 24px;
    }

    .info-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-accent);
      margin: 0 0 12px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .info-list li {
      padding: 8px 0;
      border-bottom: 1px solid var(--border-primary);
      font-size: 13px;
      line-height: 1.5;
    }

    .info-list li:last-child {
      border-bottom: none;
    }

    .key-combo {
      display: inline-block;
      padding: 2px 6px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 3px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 11px;
      color: var(--text-accent);
    }

    .highlight {
      color: var(--text-accent);
      font-weight: 500;
    }

    .status-display {
      background: var(--bg-tertiary);
      padding: 12px;
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 12px;
      color: var(--text-primary);
      margin-top: 8px;
    }

    .btn-group {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .example-box {
      background: var(--bg-tertiary);
      padding: 12px;
      border-radius: 4px;
      border-left: 3px solid var(--text-accent);
      margin-top: 8px;
      font-size: 12px;
    }

    .example-title {
      font-weight: 600;
      color: var(--text-accent);
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <!-- Header -->
    <div class="demo-header">
      <h1 class="demo-title">‚ó° Fillet Tool Demo</h1>
      <p class="demo-subtitle">Week 4 Day 16 - Professional corner rounding with arc tangency mathematics</p>
    </div>

    <!-- Controls -->
    <div class="demo-controls">
      <div class="control-group">
        <span class="control-label">Tool:</span>
        <button class="btn" id="btn-line">Line (L)</button>
        <button class="btn active" id="btn-fillet">Fillet (F)</button>
        <button class="btn" id="btn-select">Select (S)</button>
      </div>

      <div class="control-group">
        <span class="control-label">Radius:</span>
        <input type="number" id="radius-input" class="property-input" value="10" min="1" max="100" step="1" style="width: 80px;">
        <span style="font-size: 12px; color: var(--text-secondary);">mm</span>
      </div>

      <div class="control-group">
        <button class="btn" id="btn-clear">Clear All</button>
        <button class="btn" id="btn-demo-shape">Draw Demo Shape</button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="demo-main">
      <div class="canvas-area">
        <canvas id="canvas"></canvas>
      </div>

      <!-- Sidebar -->
      <div class="demo-sidebar">
        <div class="info-section">
          <h3 class="info-title">üéØ How to Use</h3>
          <ul class="info-list">
            <li><span class="key-combo">F</span> Activate Fillet Tool</li>
            <li>Click <span class="highlight">first line</span> (highlights in cyan)</li>
            <li>Hover over <span class="highlight">second line</span> (shows preview)</li>
            <li>Click <span class="highlight">second line</span> to create fillet</li>
            <li><span class="key-combo">R</span> Change radius during operation</li>
            <li><span class="key-combo">Esc</span> Cancel first line selection</li>
          </ul>
        </div>

        <div class="info-section">
          <h3 class="info-title">‚ú® Features</h3>
          <ul class="info-list">
            <li><span class="highlight">Real-time Preview</span> - Ghost arc shows result</li>
            <li><span class="highlight">Visual Feedback</span> - Color-coded line highlights</li>
            <li><span class="highlight">Variable Radius</span> - Adjust anytime with R key</li>
            <li><span class="highlight">Edge Detection</span> - Validates parallel lines</li>
            <li><span class="highlight">Smart Trimming</span> - Auto-trims lines to tangent points</li>
            <li><span class="highlight">Arc Tangency</span> - Perfect mathematical tangency</li>
          </ul>
        </div>

        <div class="info-section">
          <h3 class="info-title">üìê Mathematics</h3>
          <div class="example-box">
            <div class="example-title">Fillet Algorithm:</div>
            1. Find intersection point (extended lines)<br>
            2. Calculate bisector vector<br>
            3. Compute center: radius / sin(angle/2)<br>
            4. Find tangent points on each line<br>
            5. Create arc connecting tangents<br>
            6. Trim lines to tangent points
          </div>
        </div>

        <div class="info-section">
          <h3 class="info-title">‚ö†Ô∏è Edge Cases Handled</h3>
          <ul class="info-list">
            <li>Parallel lines - Shows error message</li>
            <li>Radius too large - Validates distance</li>
            <li>Invalid geometry - Checks NaN/Infinity</li>
            <li>Acute angles - Arc goes shortest path</li>
          </ul>
        </div>

        <div class="info-section">
          <h3 class="info-title">üìä Current Status</h3>
          <div class="status-display" id="status-display">
            Tool: Fillet<br>
            Radius: 10mm<br>
            First Line: Not selected<br>
            Preview: None
          </div>
        </div>

        <div class="info-section">
          <h3 class="info-title">üé® Visual Guide</h3>
          <div class="example-box">
            <div class="example-title">Color Coding:</div>
            <span style="color: #4ec9b0;">‚óè Cyan</span> - First line (selected)<br>
            <span style="color: #569cd6;">‚óè Blue</span> - Hover line<br>
            <span style="color: #4ec9b0; opacity: 0.5;">‚ó° Cyan Ghost</span> - Preview arc (dashed)
          </div>
        </div>

        <div class="info-section">
          <h3 class="info-title">üöÄ Quick Actions</h3>
          <div class="btn-group">
            <button class="btn btn-small" id="btn-radius-5">5mm</button>
            <button class="btn btn-small" id="btn-radius-10">10mm</button>
            <button class="btn btn-small" id="btn-radius-20">20mm</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { CADEngine } from './cad-tools/CADEngine.js';

    // Initialize
    const canvas = document.getElementById('canvas');
    const canvasArea = canvas.parentElement;
    canvas.width = canvasArea.clientWidth;
    canvas.height = canvasArea.clientHeight;

    const engine = new CADEngine(canvas);
    engine.showGrid = true;
    engine.setTool('fillet');

    // Resize handler
    window.addEventListener('resize', () => {
      canvas.width = canvasArea.clientWidth;
      canvas.height = canvasArea.clientHeight;
      engine.render();
    });

    // Button handlers
    document.getElementById('btn-line').addEventListener('click', () => {
      engine.setTool('line');
      updateButtons();
      updateStatus();
    });

    document.getElementById('btn-fillet').addEventListener('click', () => {
      engine.setTool('fillet');
      updateButtons();
      updateStatus();
    });

    document.getElementById('btn-select').addEventListener('click', () => {
      engine.setTool('select');
      updateButtons();
      updateStatus();
    });

    document.getElementById('btn-clear').addEventListener('click', () => {
      engine.objects = [];
      engine.render();
      updateStatus();
    });

    document.getElementById('btn-demo-shape').addEventListener('click', () => {
      createDemoShape();
    });

    // Radius input
    document.getElementById('radius-input').addEventListener('input', (e) => {
      const radius = parseFloat(e.target.value);
      if (engine.tools.fillet) {
        engine.tools.fillet.setRadius(radius);
      }
      updateStatus();
    });

    // Quick radius buttons
    document.getElementById('btn-radius-5').addEventListener('click', () => {
      document.getElementById('radius-input').value = 5;
      engine.tools.fillet.setRadius(5);
      updateStatus();
    });

    document.getElementById('btn-radius-10').addEventListener('click', () => {
      document.getElementById('radius-input').value = 10;
      engine.tools.fillet.setRadius(10);
      updateStatus();
    });

    document.getElementById('btn-radius-20').addEventListener('click', () => {
      document.getElementById('radius-input').value = 20;
      engine.tools.fillet.setRadius(20);
      updateStatus();
    });

    // Keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      switch(e.key.toLowerCase()) {
        case 'l':
          engine.setTool('line');
          updateButtons();
          break;
        case 'f':
          engine.setTool('fillet');
          updateButtons();
          break;
        case 's':
          engine.setTool('select');
          updateButtons();
          break;
      }
      updateStatus();
    });

    // Update button states
    function updateButtons() {
      document.querySelectorAll('.demo-controls .btn').forEach(btn => {
        btn.classList.remove('active');
      });

      if (engine.currentToolName === 'line') {
        document.getElementById('btn-line').classList.add('active');
      } else if (engine.currentToolName === 'fillet') {
        document.getElementById('btn-fillet').classList.add('active');
      } else if (engine.currentToolName === 'select') {
        document.getElementById('btn-select').classList.add('active');
      }
    }

    // Update status display
    function updateStatus() {
      const filletTool = engine.tools.fillet;
      const display = document.getElementById('status-display');

      const toolName = engine.currentToolName.charAt(0).toUpperCase() + engine.currentToolName.slice(1);
      const radius = filletTool ? filletTool.radius : 0;
      const firstLine = filletTool && filletTool.firstLine ? 'Selected ‚úì' : 'Not selected';
      const preview = filletTool && filletTool.previewArc ? 'Visible ‚úì' : 'None';

      display.innerHTML = `
        Tool: ${toolName}<br>
        Radius: ${radius}mm<br>
        First Line: ${firstLine}<br>
        Preview: ${preview}<br>
        Objects: ${engine.objects.length}
      `;
    }

    // Create demo shape (rectangle with lines to fillet)
    function createDemoShape() {
      engine.objects = [];

      const cx = canvas.width / 2;
      const cy = canvas.height / 2;
      const size = 150;

      // Create a rectangle with separate lines
      engine.objects.push({
        type: 'line',
        lineType: 'cut',
        p1: { x: cx - size, y: cy - size },
        p2: { x: cx + size, y: cy - size }
      });

      engine.objects.push({
        type: 'line',
        lineType: 'cut',
        p1: { x: cx + size, y: cy - size },
        p2: { x: cx + size, y: cy + size }
      });

      engine.objects.push({
        type: 'line',
        lineType: 'cut',
        p1: { x: cx + size, y: cy + size },
        p2: { x: cx - size, y: cy + size }
      });

      engine.objects.push({
        type: 'line',
        lineType: 'cut',
        p1: { x: cx - size, y: cy + size },
        p2: { x: cx - size, y: cy - size }
      });

      // Add some diagonal lines for variety
      engine.objects.push({
        type: 'line',
        lineType: 'crease',
        p1: { x: cx - size - 80, y: cy },
        p2: { x: cx - size + 40, y: cy - 60 }
      });

      engine.objects.push({
        type: 'line',
        lineType: 'crease',
        p1: { x: cx - size - 80, y: cy },
        p2: { x: cx - size + 40, y: cy + 60 }
      });

      engine.render();
      updateStatus();
    }

    // Update status every 200ms
    setInterval(updateStatus, 200);

    // Initial status
    updateStatus();

    console.log('üé® Fillet Tool Demo Ready');
    console.log('üìê Week 4 Day 16 - Advanced Tools Implementation');
  </script>
</body>
</html>
